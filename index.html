<meta charset=UTF-8>

<style>
  body {
    background: #fa0;
    font-family: arial;
    margin: 5em;
    color: rgb(53, 36, 3);
  }
  ul {
    list-style: none;
    font-style: italic;
    margin: 0;
    padding: 0;
  }
  li {
    padding: .1em;
    padding-left: 1em;
  }
  p {
    border-top: 1px grey solid;
    padding-top: 1em;
    font-size: 1.2em;
  }
  input[type=submit] {
    padding: .5em 0 .5em 0;
    margin: 2em 5em;
    width: 5em;
    font-size: 1em;
    background:#ffb273;
    color:#555;
    border-radius: .1em;
    border: 1px solid #ccc;
    box-shadow: 1px 1px 3px #999;
    text-align: center;
  }

</style>

<h2>Comment considérez vous les pratiques suivante ?</h2>

<ul>
  Légende des notations :
  <li>0 - plombant</li>
  <li>1 - gaspillage</li>
  <li>2 - dispensable</li>
  <li>3 - bien pratique</li>
  <li>4 - indispensable</li>
  <li>5 - enthousiasmant</li>
</ul>

<form>
  <p>De fonctionner par sprint ?
    <ra-dios name=sprint></ra-dios>
  </p>

  <p>D'avoir un backlog ?
    <ra-dios name=backlog></ra-dios>
  </p>

  <p>D'avoir des revues de code ?
    <ra-dios name=revue-de-code></ra-dios>
  </p>

  <p>D'avoir un·e scrumMaster ?
    <ra-dios name=scrumMaster></ra-dios>
  </p>

  <p>D'avoir un·e Product Owner ?
    <ra-dios name=PO></ra-dios>
  </p>

  <input type=submit value=envoyer>
</form>


<script>
  class Radios extends HTMLElement {
    constructor () {
      super()
      
      const shadow = this.attachShadow({mode: 'open'})
      const radiogroup = document.createElement('radiogroup')
      const subject = this.getAttribute('name')

      ;['plombant', 'gaspillage', 'dispensable' ,'utile' ,'nécessaire' ,'enthousiasmant'].forEach((title, index) => {
        const input = document.createElement('input')
        input.type = 'checkbox'
        input.value = `${subject}-${title}`

        const label = document.createElement('label')
        label.for = `${subject}-${title}`
        label.textContent = index

        const style = document.createElement('style')
        
        style.textContent = `
          label {
            margin-left: .3em;
            font-size: .8em;
          }
          label:after {
            content: ":";
          }
        `

        radiogroup.append(style)
        radiogroup.append(label)
        radiogroup.append(input)
      })
      shadow.append(radiogroup)
    }
  }

  customElements.define('ra-dios', Radios)

  const form = document.querySelector('form')
  form.addEventListener('submit', evt => {
    const raDios = document.querySelectorAll('ra-dios')
    const submission = Array.from(raDios)
      .map(raDio => {
        const inputs = raDio.shadowRoot.querySelectorAll('input')
        return Array.from(inputs)
          .filter(input => input.checked)
          .map(elt => elt.value)
          .join(' - ')
      }).join(' | ')
    publish(submission)
  })

  function publish(submission) {
    fetch('https://api.myjson.com/bins/18q8cl', {
      method: 'PUT',
      body: {"response": JSON.stringify(submission)},
      headers: {
        'Content-Type': 'application/json'
      }
    })
  }
</script>